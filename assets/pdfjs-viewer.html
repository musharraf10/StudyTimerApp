<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        background: #1e293b;
      }
      #pdfViewer {
        width: 100%;
        height: 100vh;
      }
      canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div id="pdfViewer"></div>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <script>
      // Get PDF URL from query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const pdfUrl = urlParams.get("pdf");

      // Load PDF with pdf.js
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      loadingTask.promise
        .then((pdf) => {
          const viewer = document.getElementById("pdfViewer");
          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            pdf.getPage(pageNum).then((page) => {
              const scale = 1.5;
              const viewport = page.getViewport({ scale });
              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d");
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              viewer.appendChild(canvas);
              page
                .render({ canvasContext: context, viewport })
                .promise.then(() => {
                  // Send page info to React Native
                  window.ReactNativeWebView.postMessage(
                    JSON.stringify({
                      page: pageNum,
                      totalPages: pdf.numPages,
                      progress: (pageNum / pdf.numPages) * 100,
                    })
                  );
                });
            });
          }
        })
        .catch((err) => {
          window.ReactNativeWebView.postMessage(
            JSON.stringify({ error: err.message })
          );
        });
    </script>
  </body>
</html>
